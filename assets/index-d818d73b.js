import{y as m,z as d,A as f,B as a,k as c,C as L,D as u,F as T,E as w,G as N,H as V,I as p,t as C,V as x}from"./vendors-4ef35f12.js";import{I as O,S as D,U as E}from"./vant-669d4264.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const s of t)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function r(t){const s={};return t.integrity&&(s.integrity=t.integrity),t.referrerPolicy&&(s.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?s.credentials="include":t.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(t){if(t.ep)return;t.ep=!0;const s=r(t);fetch(t.href,s)}})();const F="/assets/tiger-1-fbd9f986.png",M="/assets/tiger-2-ed70775d.png",A="/assets/tiger-3-f75892ab.png",B="/assets/tiger-4-b58ddbf2.png",P="/assets/tiger-5-fdac5807.png",R="/assets/tiger-6-458ea839.png";const X=(n,e)=>{const r=n.__vccOpts||n;for(const[o,t]of e)r[o]=t;return r},g=window.innerWidth,Y=[F,M,A,B,P,R],K={data(){return{tigerList:Y,configKonva:{width:g,height:g},configUpImage:{name:"upimg",image:null,x:-g/2,y:0,width:g,height:0,draggable:!0},configUpLayer:{x:g/2,y:g/2,scaleX:1,scaleY:1},configTigers:[],selectedShapeName:"",slideValue:1}},methods:{afterRead(n){const e=new window.Image;e.src=n.content,e.onload=()=>{this.configUpImage.image=e,this.configUpImage.height=parseInt(g/(e.width/e.height)),this.configUpImage.y=-this.configUpImage.height/2,this.slideValue=1}},addTiger(n,e){const r=this.configTigers.findIndex(o=>o.name===`tiger${e}`);if(r>-1)this.configTigers.splice(r,1),this.selectedShapeName="",this.updateTransformer();else{const o=new window.Image;o.src=n,o.onload=()=>{this.configTigers.push({name:`tiger${e}`,image:o,x:0,y:0,width:160,height:200,draggable:!0,scaleX:1,scaleY:1})}}},slideChange(n){this.configUpLayer.scaleX=n,this.configUpLayer.scaleY=n},downLoad(){this.selectedShapeName="",this.updateTransformer();const n=this.$refs.stage.getNode().toDataURL({pixelRatio:3});let e=document.createElement("a");e.download="tiger",e.href=n,document.body.appendChild(e),e.click(),document.body.removeChild(e)},handleTransformEnd(n){const e=this.configTigers.find(r=>r.name===this.selectedShapeName);e.x=n.target.x(),e.y=n.target.y(),e.rotation=n.target.rotation(),e.scaleX=n.target.scaleX(),e.scaleY=n.target.scaleY()},handleStageMouseDown(n){if(n.target===n.target.getStage()){this.selectedShapeName="",this.updateTransformer();return}if(n.target.getParent().className==="Transformer")return;const r=n.target.name();this.configTigers.find(t=>t.name===r)?this.selectedShapeName=r:this.selectedShapeName="",this.updateTransformer()},updateTransformer(){const n=this.$refs.transformer.getNode(),e=n.getStage(),{selectedShapeName:r}=this,o=e.findOne("."+r);o!==n.node()&&(o?n.nodes([o]):n.nodes([]))}}},z={class:"g-tiger ignore"},W={class:"m-upimg"},j={key:0,class:"no-img"},q=a("p",null,"请上传图片",-1),G={class:"m-tiger"},H=a("p",{class:"titi"},"图片缩放：",-1),J={class:"slide"},Q={class:"m-tiger"},Z=a("p",{class:"titi"},"点击选择你的头套：",-1),$=["onClick"],ee=["src"],te={class:"m-btn"};function ne(n,e,r,o,t,s){const l=O,h=m("v-image"),_=m("v-layer"),S=m("v-transformer"),I=m("v-stage"),U=D,k=E;return d(),f("div",z,[a("div",W,[t.configUpImage.image?L("",!0):(d(),f("div",j,[c(l,{name:"photo",class:"icon"}),q])),c(I,{ref:"stage",config:t.configKonva,onMousedown:s.handleStageMouseDown,onTouchstart:s.handleStageMouseDown},{default:u(()=>[c(_,{ref:"upimg",config:t.configUpLayer},{default:u(()=>[c(h,{config:t.configUpImage},null,8,["config"])]),_:1},8,["config"]),c(_,{ref:"tiger"},{default:u(()=>[(d(!0),f(T,null,w(t.configTigers,i=>(d(),N(h,{key:i.name,config:i,onTransformend:s.handleTransformEnd},null,8,["config","onTransformend"]))),128)),c(S,{ref:"transformer",config:{anchorFill:"#fc4459",anchorSize:24,borderStroke:"#898FFA",borderStrokeWidth:2,borderDash:[3,3],keepRatio:!1}},null,512)]),_:1},512)]),_:1},8,["config","onMousedown","onTouchstart"])]),a("div",G,[H,a("div",J,[c(U,{modelValue:t.slideValue,"onUpdate:modelValue":[e[0]||(e[0]=i=>t.slideValue=i),s.slideChange],step:.01,min:0,max:5},null,8,["modelValue","onUpdate:modelValue"])])]),a("div",Q,[Z,a("ul",null,[(d(!0),f(T,null,w(t.tigerList,(i,v)=>(d(),f("li",{onClick:y=>s.addTiger(i,v),class:V(t.configTigers.find(y=>y.name===`tiger${v}`)&&"active")},[a("img",{src:i},null,8,ee)],10,$))),256))])]),a("div",te,[t.configUpImage.image?(d(),f("a",{key:1,href:"javascript:;",class:"btn del",onClick:e[1]||(e[1]=i=>t.configUpImage.image=null)},[c(l,{name:"delete-o"}),p(" 删除图片 ")])):(d(),N(k,{key:0,"after-read":s.afterRead,class:"btn"},{default:u(()=>[c(l,{name:"back-top"}),p(" 上传图片 ")]),_:1},8,["after-read"])),a("a",{href:"javascript:;",class:"btn active",onClick:e[2]||(e[2]=(...i)=>s.downLoad&&s.downLoad(...i))},[c(l,{name:"down"}),p(" 下载图片 ")])])])}const se=X(K,[["render",ne]]),b=C(se);b.use(x);b.mount("#app");

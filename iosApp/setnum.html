<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>设置QQ号</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=1, minimum-scale=1.0, maximum-scale=1.0">
    <meta name="keywords" content="" />
    <meta name="description" content="" />
    <meta name="format-detection" content="telephone=no" />
    <link rel="stylesheet" href="release/css/from.css">
</head>
<body>

    <!-- <section class="g-setform">
        <header class="m-heardtr">
            <h3>请务必填写正确的收货信息</h3>
            <p>当前信息填写后，则<span>无法修改</span></p>
        </header>
        <div class="m-infbox m-infboxtr">
            <form id="j-form">
                <label class="m-textla j-textla i-must">
                    <input class="m-text" type="text" placeholder="收货人姓名">
                    <i></i>
                </label>
                <label class="m-textla j-textla i-must">
                    <input class="m-text" type="number" placeholder="手机号码">
                    <i></i>
                </label>
                <a href="javascript:;" class="m-textla m-addsella j-textla i-must">
                    <span>省、市、区</span>
                    <span class="selecd">福建 厦门</span>
                </a>
                <label class="m-textla j-textla i-must">
                    <input class="m-text" type="text" placeholder="详细地址">
                    <i></i>
                </label>
                <label class="m-textla j-textla">
                    <input class="m-text" type="number" placeholder="QQ号码">
                    <i></i>
                </label>
                <input class="m-button j-submit" type="submit" value="确定">
            </form>
        </div>
    </section> -->

    <section class="g-setform">
        <header class="m-heard j-header"> </header>
        <div class="m-infbox m-infboxdr">
            <form id="j-form"> </form>
        </div>
    </section>

    <script type="text/template" id="j-inputTemp">
        <label class="m-textla j-textla">
            <input class="m-text" type="text" placeholder="请输入要充值的<%=type%>">
            <i></i>
        </label>
        <label class="m-textla j-textla">
            <input class="m-text j-confirm" type="text" placeholder="请再次输入<%=type%>">
            <i></i>
        </label>
        <input class="m-button z-prevent j-submit" type="submit" value="确定">
    </script>

    <script src="release/js/zepto.min.js"></script>
    <script src="release/js/baiduTemplate.js"></script>
    <script>
        var ClientAPI = {};
        ClientAPI.onJsToast = function(message){
            alert(message);
        };
        ClientAPI.onJsGetData = function(data){
            return;
        };


        /*window.onerror = function(message, file, line, at){
            alert('message:' + message + '; file : ' + file + ';line: ' + line + ';at:' + at);
        };*/
        var TopicApp = {};
        // var ClientAPI = {};
        // ClientAPI.onJsToast = onJsToast;
        // ClientAPI.onJsGetData = onJsGetData;
        // ClientAPI.onJsPageBack = onJsPageBack;

        function getUrlParam(name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
            var r = window.location.search.substr(1).match(reg);
            if (r != null) return unescape(r[2]); return null;
        };

        function SetNum(){
            var obj = this;
            var _url = 'app/iphone/v1.0/hebi-bind.html';
            var _dom = {
                $header: $('.j-header'),
                $form: $('#j-form')
            };
            var type = getUrlParam('type');
            var typeStr = {
                qq: 'QQ号',
                phone: '手机号',
                mimi: '米米账号',
                duoduo: '多多账号',
                zfb: '支付宝账号'
            };

            this.init = function(){
                this.setType();
                this.events();
            };

            this.setType = function(){
                var inputHtml = baidu.template('j-inputTemp',{type: typeStr[type] });
                var heardHtml = '每个账户仅能设置<span>唯一' + typeStr[type] +'</span>，且<span>无法修改</span>';
                _dom.$header.html(heardHtml);
                _dom.$form.html(inputHtml);
            };

            this.events = function(){
                $('.j-first,.j-confirm').on('keyup',function(){
                    var textInput = _dom.$form.find('[type=text]');
                    if( $(this)[0].value.trim() !== '' ){
                        $(this).parent().addClass('z-textdel');
                    }else{
                        $(this).parent().removeClass('z-textdel');
                    };
                    if( textInput[0].value.trim() !== '' && textInput[1].value.trim() !== '' ){
                        _dom.$form.find('.j-submit').removeClass('z-prevent');
                    }else{
                        _dom.$form.find('.j-submit').addClass('z-prevent');
                    }
                }).on('paste',function(){
                    var textInput = _dom.$form.find('[type=text]');
                    setTimeout(function(){
                        if( textInput[0].value.trim() !== '' && textInput[1].value.trim() !== '' ){
                            _dom.$form.find('.j-submit').removeClass('z-prevent');
                        }else{
                            _dom.$form.find('.j-submit').addClass('z-prevent');
                        }
                    },10);
                });

                $(document).on('tap','.j-textla i',function(){
                    $(this).siblings().val('');
                    $(this).parent().removeClass('z-textdel');
                    _dom.$form.find('.j-submit').addClass('z-prevent');
                });

                $('#j-form').on('submit',function(){
                    if($(this).find('.j-submit').hasClass('z-prevent')){
                        return false;
                    };

                    var firstVal = $(this).find('.j-first').val().trim();
                    var confirmVal = $(this).find('.j-confirm').val().trim();

                    if( type == 'qq' && !isQQ(firstVal)  ){
                        ClientAPI.onJsToast('QQ号格式有误');
                        return false;
                    }else if(type == 'phone' &&  !isPhone(firstVal)){
                        ClientAPI.onJsToast('请输入11位数的手机号');
                        return false;
                    } else if(firstVal !== confirmVal){
                        ClientAPI.onJsToast('两次输入不一致。');
                        return false;
                    };
                    
                    alert('success');
                    // ClientAPI.onJsGetData({
                    //     id: 'qq',
                    //     type: 'post',
                    //     url:_url,
                    //     data:{key:type, value: firstVal}
                    // });
                    return false;
                });

                TopicApp.onGetDataCallBack = function(id,data){
                    data = JSON.parse(data);
                    ClientAPI.onJsToast(data.message);
                    if(data.code == 100){
                        setTimeout(function(){
                            ClientAPI.onJsPageBack();

                        },1000);
                    }
                };

                function isQQ(num) {
                    return RegExp(/^[1-9][0-9]{4,9}$/).test(num);
                };
                function isPhone(num) {
                    return RegExp(/^[1-9][0-9]{10}$/).test(num);
                };
            };
        };

        $(function(){
            (new SetNum()).init()
        });
    </script>
</body>
</html>
